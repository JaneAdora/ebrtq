<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EBRTQ Admin - Content Editor</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px;
            background: #f5f5f5;
        }
        
        /* Mobile responsive body */
        @media (max-width: 768px) {
            body {
                padding: 15px;
            }
        }
        
        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
        }
        .header {
            background: linear-gradient(135deg, #1e1e2e 0%, #2a1f3d 25%, #1f2937 50%, #1e3a5f 75%, #1e1e2e 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }
        
        /* Mobile responsive header */
        @media (max-width: 768px) {
            .header {
                padding: 15px;
                margin-bottom: 15px;
            }
            
            .header h1 {
                font-size: 1.5rem;
            }
        }
        .login-form {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-width: 400px;
            margin: 50px auto;
        }
        
        /* Mobile responsive login form */
        @media (max-width: 768px) {
            .login-form {
                padding: 20px;
                margin: 30px auto;
                max-width: 100%;
            }
        }
        
        @media (max-width: 480px) {
            .login-form {
                padding: 15px;
                margin: 20px auto;
            }
        }
        #password {
            color: #333 !important;
            background-color: #fff !important;
            border: 2px solid #ddd !important;
        }
        #password:focus {
            border-color: #BB86FC !important;
            box-shadow: 0 0 0 2px rgba(187, 134, 252, 0.2) !important;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #333;
        }
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            color: #333;
            background-color: #fff;
            box-sizing: border-box;
        }
        
        /* Mobile responsive form elements */
        @media (max-width: 768px) {
            input, select, textarea {
                padding: 12px;
                font-size: 16px; /* Prevents zoom on iOS */
            }
        }
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #BB86FC;
            box-shadow: 0 0 0 2px rgba(187, 134, 252, 0.2);
        }
        button {
            background: #BB86FC;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
        }
        button:hover {
            background: #9c6bdb;
        }
        .resource-card {
            background: white;
            padding: 25px;
            border-radius: 8px;
            margin-bottom: 25px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: box-shadow 0.2s ease;
        }
        
        .resource-card:hover {
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
        }
        
        /* Mobile responsive resource cards */
        @media (max-width: 768px) {
            .resource-card {
                padding: 15px;
                margin-bottom: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .resource-card {
                padding: 12px;
                margin-bottom: 12px;
            }
        }
        .resource-card input, .resource-card select {
            color: #333 !important;
            background-color: #fff !important;
            border: 1px solid #ddd !important;
        }
        .resource-card input:focus, .resource-card select:focus {
            border-color: #BB86FC !important;
            box-shadow: 0 0 0 2px rgba(187, 134, 252, 0.2) !important;
        }
        
        /* Override any external CSS that might be affecting input visibility */
        input, select, textarea {
            color: #333 !important;
            background-color: #fff !important;
            border: 1px solid #ddd !important;
        }
        
        /* Ensure all input types are visible */
        input[type="text"], input[type="password"], input[type="url"], input[type="email"] {
            color: #333 !important;
            background-color: #fff !important;
        }
        
        /* Force text visibility with maximum specificity */
        body input, body select, body textarea {
            color: #333 !important;
            background-color: #fff !important;
            border: 1px solid #ddd !important;
        }
        
        /* Specific overrides for the login form */
        .login-form input {
            color: #333 !important;
            background-color: #fff !important;
            border: 2px solid #ddd !important;
        }
        .resource-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 25px;
        }
        
        /* Mobile responsive grid */
        @media (max-width: 768px) {
            .resource-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .resource-grid {
                gap: 12px;
            }
        }
        .actions {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin: 30px 0;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .actions-top {
            display: flex;
            justify-content: center;
            width: 100%;
        }
        
        .actions-bottom {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        /* Mobile responsive actions */
        @media (max-width: 768px) {
            .actions-bottom {
                flex-direction: column;
                gap: 12px;
            }
            
            .actions-bottom button {
                width: 100%;
                padding: 12px;
                font-size: 16px;
            }
        }
        .btn-secondary {
            background: #6c757d;
        }
        .btn-danger {
            background: #dc3545;
        }
        .btn-success {
            background: #28a745;
        }
        .hidden {
            display: none;
        }
        
        /* Accordion styles */
        .accordion {
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-bottom: 30px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: box-shadow 0.2s ease;
        }
        
        .accordion:hover {
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        .accordion-header {
            background: #f8f9fa;
            padding: 20px 25px;
            cursor: pointer;
            border-bottom: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease;
        }
        
        .accordion-header:hover {
            background: #e9ecef;
        }
        
        .accordion-header h2 {
            margin: 0;
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
        }
        
        .accordion-icon {
            font-size: 1.2rem;
            transition: transform 0.2s;
            color: #333;
        }
        
        .accordion-icon.rotated {
            transform: rotate(180deg);
        }
        
        .accordion-content {
            padding: 25px 30px;
            display: none;
        }
        
        .accordion-content.open {
            display: block;
        }
        
        /* Toggle Switch Styles */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 120px;
            height: 40px;
            background: #ddd;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid #ddd;
            overflow: hidden;
        }
        
        .toggle-switch.preview {
            background: #28a745;
            border-color: #28a745;
        }
        
        .toggle-switch.edit {
            background: #007bff;
            border-color: #007bff;
        }
        
        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 56px;
            height: 32px;
            background: white;
            border-radius: 16px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            z-index: 1;
        }
        
        .toggle-switch.preview .toggle-slider {
            transform: translateX(56px);
        }
        
        .toggle-text {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            font-size: 12px;
            font-weight: 700;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.9);
            transition: all 0.3s ease;
            pointer-events: none;
            z-index: 3;
        }
        
        .toggle-text.left {
            left: 8px;
        }
        
        .toggle-text.right {
            right: 8px;
        }
        
        .toggle-switch.preview .toggle-text.right {
            display: none;
        }
        
        .toggle-switch.edit .toggle-text.left {
            display: none;
        }
        
        /* Improved Button Styles */
        .btn-logout {
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
        }
        
        .btn-logout:hover {
            background: #dc3545;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .btn-save {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
        }
        
        .btn-save:hover {
            background: #218838;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>🏳️‍⚧️ EBRTQ Content Editor</h1>
        <p>Manage resources for East Baton Rouge Trans and Queer community</p>
    </div>

    <div id="loginForm" class="login-form">
        <h2>Admin Login</h2>
        <div class="form-group">
            <label for="password">Password:</label>
            <input type="password" id="password" placeholder="Enter admin password">
        </div>
        <button onclick="login()">Login</button>
    </div>

    <div id="editor" class="hidden">
        <div class="actions">
            <div class="actions-top">
                <div class="toggle-switch edit" id="previewToggle" onclick="togglePreview()">
                    <div class="toggle-slider"></div>
                    <span class="toggle-text left">Edit</span>
                    <span class="toggle-text right">Preview</span>
                </div>
            </div>
            <div class="actions-bottom">
                <button class="btn-save" onclick="saveChanges()">Save Changes</button>
                <button class="btn-logout" onclick="logout()">Logout</button>
            </div>
        </div>

        <!-- Site Settings Section -->
        <div class="accordion">
            <div class="accordion-header" onclick="toggleAccordion('siteSettings')">
                <h2>🏳️‍⚧️ Site Settings</h2>
                <span class="accordion-icon" id="siteSettings-icon">▼</span>
            </div>
            <div class="accordion-content" id="siteSettings-content">
                <div class="resource-grid">
                    <div>
                        <label>Page Title (Browser Tab):</label>
                        <input type="text" id="pageTitle" value="" placeholder="Page title for browser tab">
                    </div>
                    <div>
                        <label>Main Heading (H1):</label>
                        <input type="text" id="h1" value="" placeholder="Main heading on the page">
                    </div>
                    <div>
                        <label>Tagline (Under H1):</label>
                        <input type="text" id="tagline" value="" placeholder="Tagline under the main heading">
                    </div>
                    <div>
                        <label>Meta Description (SEO):</label>
                        <textarea id="metaDescription" placeholder="Description for search engines" style="height: 80px; resize: vertical;"></textarea>
                    </div>
                </div>
            </div>
        </div>

        <!-- Custom Types Management Section -->
        <div class="accordion">
            <div class="accordion-header" onclick="toggleAccordion('customTypes')">
                <h2>🏷️ Resource Types Management</h2>
                <span class="accordion-icon" id="customTypes-icon">▼</span>
            </div>
            <div class="accordion-content" id="customTypes-content">
                <div class="resource-grid">
                    <div>
                        <label>Add New Type:</label>
                        <input type="text" id="newTypeName" placeholder="Enter new resource type (e.g., 'Legal Aid')">
                    </div>
                    <div>
                        <button onclick="addCustomType()" style="background: #FF006E; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer;">
                            + Add Type
                        </button>
                    </div>
                </div>
                <div id="customTypesList" style="margin-top: 15px;">
                    <!-- Custom types will be listed here -->
                </div>
            </div>
        </div>

        <!-- Resources Section -->
        <div class="accordion">
            <div class="accordion-header" onclick="toggleAccordion('resources')">
                <h2>📋 Resources Management</h2>
                <span class="accordion-icon" id="resources-icon">▼</span>
            </div>
            <div class="accordion-content" id="resources-content">
                <div id="resourceList"></div>
                <button onclick="addResource()" style="margin-top: 20px; background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer;">
                    + Add New Resource
                </button>
            </div>
        </div>
    </div>

    <script>
        const ADMIN_PASSWORD = "ebrtq2025"; // Change this!
        let resources = [];
        let isPreview = false;
        let siteSettings = {
            pageTitle: "EBRTQ - East Baton Rouge Trans & Queer Resources",
            h1: "EBRTQ",
            tagline: "→ Connecting Our Community to Resources ←",
            metaDescription: "Find LGBTQ+ resources, support groups, healthcare, crisis support, and community services in East Baton Rouge. Connecting our trans and queer community to vital resources."
        };
        
        // Custom resource types
        let customTypes = [];

        // Real data from resources.json
        const realResources = [
            {
                "id": "1",
                "title": "Pride Center - Support Groups",
                "url": "#",
                "provider": "Local Pride Center",
                "type": "Mental Health",
                "icon": "Users",
                "color": "blue"
            },
            {
                "id": "2",
                "title": "Pride Center - Youth Programs",
                "url": "#",
                "provider": "Local Pride Center",
                "type": "Youth Services",
                "icon": "Heart",
                "color": "pink"
            },
            {
                "id": "3",
                "title": "Pride Center - Social Events",
                "url": "#",
                "provider": "Local Pride Center",
                "type": "Community",
                "icon": "Users",
                "color": "purple"
            },
            {
                "id": "4",
                "title": "Rainbow Health - Primary Care",
                "url": "#",
                "provider": "Rainbow Health Clinic",
                "type": "Healthcare",
                "icon": "Activity",
                "color": "cyan"
            },
            {
                "id": "5",
                "title": "Rainbow Health - Hormone Therapy",
                "url": "#",
                "provider": "Rainbow Health Clinic",
                "type": "Healthcare",
                "icon": "Activity",
                "color": "pink"
            },
            {
                "id": "6",
                "title": "Trans Lifeline - 24/7 Hotline",
                "url": "#",
                "provider": "Trans Lifeline",
                "type": "Crisis Support",
                "icon": "Phone",
                "color": "magenta"
            },
            {
                "id": "7",
                "title": "Trevor Project - Crisis Chat",
                "url": "#",
                "provider": "The Trevor Project",
                "type": "Crisis Support",
                "icon": "Phone",
                "color": "green"
            },
            {
                "id": "8",
                "title": "Legal Aid - Name Change Help",
                "url": "#",
                "provider": "LGBTQ Legal Services",
                "type": "Legal Services",
                "icon": "Shield",
                "color": "purple"
            },
            {
                "id": "9",
                "title": "Safe Housing Network",
                "url": "#",
                "provider": "Rainbow Housing Collective",
                "type": "Housing",
                "icon": "Home",
                "color": "green"
            },
            {
                "id": "10",
                "title": "Scholarship Resources",
                "url": "#",
                "provider": "LGBTQ Education Fund",
                "type": "Education",
                "icon": "GraduationCap",
                "color": "cyan"
            },
            {
                "id": "11",
                "title": "Job Training & Placement",
                "url": "#",
                "provider": "Pride Works",
                "type": "Employment",
                "icon": "Briefcase",
                "color": "magenta"
            },
            {
                "id": "12",
                "title": "LGBTQ Resource Library",
                "url": "#",
                "provider": "Community Library",
                "type": "Education",
                "icon": "BookOpen",
                "color": "blue"
            }
        ];

        function login() {
            const password = document.getElementById('password').value;
            if (password === ADMIN_PASSWORD) {
                document.getElementById('loginForm').classList.add('hidden');
                document.getElementById('editor').classList.remove('hidden');
                loadResources();
                loadSiteSettings();
                renderCustomTypes();
                
                // Open the resources accordion by default
                toggleAccordion('resources');
            } else {
                alert('Incorrect password');
            }
        }

        function logout() {
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('editor').classList.add('hidden');
            document.getElementById('password').value = '';
        }

        function loadResources() {
            // Load the real resources data
            resources = [...realResources];
            renderResources();
        }

        function loadSiteSettings() {
            // Load site settings into the form
            document.getElementById('pageTitle').value = siteSettings.pageTitle;
            document.getElementById('h1').value = siteSettings.h1;
            document.getElementById('tagline').value = siteSettings.tagline;
            document.getElementById('metaDescription').value = siteSettings.metaDescription;
        }

        function updateSiteSettings() {
            // Update site settings from form
            siteSettings.pageTitle = document.getElementById('pageTitle').value;
            siteSettings.h1 = document.getElementById('h1').value;
            siteSettings.tagline = document.getElementById('tagline').value;
            siteSettings.metaDescription = document.getElementById('metaDescription').value;
        }

        function addCustomType() {
            const newTypeName = document.getElementById('newTypeName').value.trim();
            if (newTypeName && !customTypes.includes(newTypeName)) {
                customTypes.push(newTypeName);
                document.getElementById('newTypeName').value = '';
                renderCustomTypes();
                renderResources(); // Re-render to update type dropdowns
            } else if (customTypes.includes(newTypeName)) {
                alert('This type already exists!');
            } else {
                alert('Please enter a type name');
            }
        }

        function removeCustomType(typeName) {
            if (confirm(`Are you sure you want to remove the type "${typeName}"?`)) {
                customTypes = customTypes.filter(t => t !== typeName);
                renderCustomTypes();
                renderResources(); // Re-render to update type dropdowns
            }
        }

        function renderCustomTypes() {
            const container = document.getElementById('customTypesList');
            if (customTypes.length === 0) {
                container.innerHTML = '<p style="color: #666; font-style: italic;">No custom types added yet.</p>';
            } else {
                container.innerHTML = customTypes.map(type => `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px; background: #f8f9fa; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 5px;">
                        <span>${type}</span>
                        <button onclick="removeCustomType('${type}')" style="background: #dc3545; color: white; border: none; padding: 4px 8px; border-radius: 3px; cursor: pointer; font-size: 12px;">
                            Remove
                        </button>
                    </div>
                `).join('');
            }
        }

        function toggleAccordion(sectionId) {
            const content = document.getElementById(sectionId + '-content');
            const icon = document.getElementById(sectionId + '-icon');
            
            if (content.classList.contains('open')) {
                // Close the accordion
                content.classList.remove('open');
                icon.classList.remove('rotated');
                icon.textContent = '▼';
            } else {
                // Open the accordion
                content.classList.add('open');
                icon.classList.add('rotated');
                icon.textContent = '▲';
            }
        }

        function getTypeOptions(selectedType) {
            const defaultTypes = [
                "Mental Health", "Healthcare", "Crisis Support", "Legal Services", 
                "Housing", "Education", "Employment", "Community", "Youth Services"
            ];
            const allTypes = [...defaultTypes, ...customTypes];
            
            return allTypes.map(type => 
                `<option value="${type}" ${selectedType === type ? 'selected' : ''}>${type}</option>`
            ).join('');
        }

        function getCurrentFormData() {
            console.log('getCurrentFormData called, isPreview:', isPreview);
            
            // Capture current form data for preview
            const currentData = [];
            const resourceCards = document.querySelectorAll('.resource-card');
            
            console.log('Found resource cards:', resourceCards.length);
            
            resourceCards.forEach((card, index) => {
                const titleInput = card.querySelector('input[onchange*="title"]');
                const urlInput = card.querySelector('input[onchange*="url"]');
                const providerInput = card.querySelector('input[onchange*="provider"]');
                const typeSelect = card.querySelector('select[onchange*="type"]');
                const iconSelect = card.querySelector('select[onchange*="icon"]');
                const colorSelect = card.querySelector('select[onchange*="color"]');
                
                if (titleInput) {
                    const resourceData = {
                        id: resources[index]?.id || (index + 1).toString(),
                        title: titleInput.value,
                        url: urlInput?.value || '',
                        provider: providerInput?.value || '',
                        type: typeSelect?.value || '',
                        icon: iconSelect?.value || '',
                        color: colorSelect?.value || ''
                    };
                    currentData.push(resourceData);
                    console.log('Captured resource data:', resourceData);
                }
            });
            
            console.log('Returning currentData:', currentData);
            return currentData;
        }

        function renderResources() {
            const container = document.getElementById('resourceList');
            console.log('renderResources called, isPreview:', isPreview);
            
            if (isPreview) {
                // Get current form data for preview
                const currentData = getCurrentFormData();
                console.log('Preview data:', currentData);
                
                // Also update site settings preview
                updateSiteSettings();
                const siteSettingsPreview = `
                    <div style="background: #f8f9fa !important; color: #333 !important; margin-bottom: 20px; border: 2px solid #5BCEFA; padding: 25px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                        <h2 style="color: #5BCEFA !important; margin-bottom: 10px;">🏳️‍⚧️ Site Preview</h2>
                        <p style="color: #333 !important;"><strong style="color: #5BCEFA !important;">Page Title:</strong> ${siteSettings.pageTitle}</p>
                        <p style="color: #333 !important;"><strong style="color: #5BCEFA !important;">Main Heading:</strong> ${siteSettings.h1}</p>
                        <p style="color: #333 !important;"><strong style="color: #5BCEFA !important;">Tagline:</strong> ${siteSettings.tagline}</p>
                        <p style="color: #333 !important;"><strong style="color: #5BCEFA !important;">Meta Description:</strong> ${siteSettings.metaDescription}</p>
                    </div>
                `;
                
                container.innerHTML = siteSettingsPreview + currentData.map(resource => `
                    <div class="resource-card" style="background: #f8f9fa !important; color: #333 !important;">
                        <h3 style="color: #333 !important;">${resource.title}</h3>
                        <p style="color: #333 !important;"><strong style="color: #5BCEFA !important;">Provider:</strong> ${resource.provider}</p>
                        <p style="color: #333 !important;"><strong style="color: #5BCEFA !important;">Type:</strong> ${resource.type}</p>
                        <p style="color: #333 !important;"><strong style="color: #5BCEFA !important;">URL:</strong> <a href="${resource.url}" style="color: #007bff !important;">${resource.url}</a></p>
                        <p style="color: #333 !important;"><strong style="color: #5BCEFA !important;">Icon:</strong> ${resource.icon} | <strong style="color: #5BCEFA !important;">Color:</strong> ${resource.color}</p>
                    </div>
                `).join('');
            } else {
                container.innerHTML = resources.map((resource, index) => `
                    <div class="resource-card">
                        <h3 style="color: #333 !important;">Resource ${index + 1}</h3>
                        <div class="resource-grid">
                            <div>
                                <label>Title:</label>
                                <input type="text" value="${resource.title}" onchange="updateResource(${resource.id}, 'title', this.value)">
                            </div>
                            <div>
                                <label>URL:</label>
                                <input type="url" value="${resource.url}" onchange="updateResource(${resource.id}, 'url', this.value)">
                            </div>
                            <div>
                                <label>Provider:</label>
                                <input type="text" value="${resource.provider}" onchange="updateResource(${resource.id}, 'provider', this.value)">
                            </div>
                            <div>
                                <label>Type:</label>
                                <select onchange="updateResource(${resource.id}, 'type', this.value)">
                                    ${getTypeOptions(resource.type)}
                                </select>
                            </div>
                            <div>
                                <label>Icon:</label>
                                <select onchange="updateResource(${resource.id}, 'icon', this.value)">
                                    <option value="Heart" ${resource.icon === 'Heart' ? 'selected' : ''}>Heart</option>
                                    <option value="Home" ${resource.icon === 'Home' ? 'selected' : ''}>Home</option>
                                    <option value="Users" ${resource.icon === 'Users' ? 'selected' : ''}>Users</option>
                                    <option value="Phone" ${resource.icon === 'Phone' ? 'selected' : ''}>Phone</option>
                                    <option value="BookOpen" ${resource.icon === 'BookOpen' ? 'selected' : ''}>BookOpen</option>
                                    <option value="Activity" ${resource.icon === 'Activity' ? 'selected' : ''}>Activity</option>
                                    <option value="Briefcase" ${resource.icon === 'Briefcase' ? 'selected' : ''}>Briefcase</option>
                                    <option value="GraduationCap" ${resource.icon === 'GraduationCap' ? 'selected' : ''}>GraduationCap</option>
                                    <option value="Shield" ${resource.icon === 'Shield' ? 'selected' : ''}>Shield</option>
                                </select>
                            </div>
                            <div>
                                <label>Color:</label>
                                <select onchange="updateResource(${resource.id}, 'color', this.value)">
                                    <option value="blue" ${resource.color === 'blue' ? 'selected' : ''}>Blue</option>
                                    <option value="pink" ${resource.color === 'pink' ? 'selected' : ''}>Pink</option>
                                    <option value="white" ${resource.color === 'white' ? 'selected' : ''}>White</option>
                                    <option value="purple" ${resource.color === 'purple' ? 'selected' : ''}>Purple</option>
                                    <option value="magenta" ${resource.color === 'magenta' ? 'selected' : ''}>Magenta</option>
                                    <option value="cyan" ${resource.color === 'cyan' ? 'selected' : ''}>Cyan</option>
                                    <option value="green" ${resource.color === 'green' ? 'selected' : ''}>Green</option>
                                </select>
                            </div>
                        </div>
                        <div style="text-align: right; margin-top: 10px;">
                            <button class="btn-danger" onclick="deleteResource('${resource.id}')">Delete</button>
                        </div>
                    </div>
                `).join('');
            }
        }

        function updateResource(id, field, value) {
            const resource = resources.find(r => r.id === id);
            if (resource) {
                resource[field] = value;
            }
        }

        function deleteResource(id) {
            console.log('Attempting to delete resource with id:', id, 'type:', typeof id);
            console.log('Current resources before delete:', resources.map(r => ({id: r.id, title: r.title})));
            
            if (confirm('Are you sure you want to delete this resource?')) {
                // Remove from resources array
                const originalLength = resources.length;
                resources = resources.filter(r => r.id !== id);
                
                console.log('Resources after delete:', resources.map(r => ({id: r.id, title: r.title})));
                console.log('Deleted?', originalLength > resources.length);
                
                // Re-render to show updated data
                renderResources();
            }
        }

        function addResource() {
            const newId = (Math.max(...resources.map(r => parseInt(r.id))) + 1).toString();
            resources.push({
                id: newId,
                title: "New Resource",
                url: "",
                provider: "",
                type: "Mental Health",
                icon: "Users",
                color: "blue"
            });
            renderResources();
        }

        function togglePreview() {
            isPreview = !isPreview;
            const toggle = document.getElementById('previewToggle');
            
            if (isPreview) {
                // Update site settings before showing preview
                updateSiteSettings();
                toggle.classList.remove('edit');
                toggle.classList.add('preview');
            } else {
                toggle.classList.remove('preview');
                toggle.classList.add('edit');
            }
            
            renderResources();
        }

        async function saveChanges() {
            // Update site settings from form
            updateSiteSettings();
            
            // Show loading state
            const saveButton = document.querySelector('.btn-save');
            const originalText = saveButton.textContent;
            saveButton.textContent = 'Saving...';
            saveButton.disabled = true;
            
            try {
                // Prepare data for API
                const dataToSave = {
                    resources: resources,
                    siteSettings: siteSettings,
                    customTypes: customTypes,
                    password: 'ebrtq2025'
                };
                
                console.log('Saving data:', dataToSave);
                
                // Call the API endpoint
                const response = await fetch('/api/save-content', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(dataToSave)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    alert(`✅ Changes saved successfully!\n\n${result.message}\nResources: ${result.resources}\nTimestamp: ${result.timestamp}`);
                } else {
                    throw new Error(result.error || 'Failed to save changes');
                }
            } catch (error) {
                console.error('Error saving changes:', error);
                alert(`❌ Failed to save changes:\n\n${error.message}\n\nPlease try again or check the console for details.`);
            } finally {
                // Restore button state
                saveButton.textContent = originalText;
                saveButton.disabled = false;
            }
        }

        // Allow Enter key to login
        document.getElementById('password').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                login();
            }
        });

        // Add event listeners for site settings
        document.addEventListener('DOMContentLoaded', function() {
            // Add event listeners to site settings inputs
            const siteSettingsInputs = ['pageTitle', 'h1', 'tagline', 'metaDescription'];
            siteSettingsInputs.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('input', updateSiteSettings);
                }
            });
        });
    </script>
</body>
</html>
